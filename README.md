# Forward Reader - 智能合并转发分析插件 (v1.2.0)

一个为 [AstrBot](https://github.com/Soulter/AstrBot) 设计的插件，可以像真人一样，智能地分析和总结 QQ 中的合并转发消息，并与用户进行自然语言交互。

## ✨ 功能特性

- **无指令交互**: 无需任何指令，插件会自动感知并处理与合并转发相关的消息。
- **智能场景识别**:
  - **直接分析**: 当有用户直接发送合并转发消息时，可配置自动进行分析总结。
  - **上下文分析**: 当用户回复或引用一条合并转发消息并提问时（如“总结一下”、“这聊了啥？”），插件能理解其意图，并结合聊天记录和问题进行回答。
- **多模态支持**: 能够提取并发送聊天记录中的文本和图片给 LLM 进行综合分析。
- **全局人格集成**: 插件通过标准的 `event.request_llm()` 方法与 AstrBot 核心交互，这意味着它会**自动使用您在 AstrBot 中配置的全局 LLM 提供商、模型和人格 (System Prompt)**，确保分析风格与您的机器人完全一致。
- **高度可配置**: 用户可以独立开关两种自动分析场景，以平衡功能性与资源消耗。

## 🚀 安装

1. 下载插件。
2. 将 `astrbot_plugin_forward_reader` 文件夹放入 AstrBot 的 `plugins` 目录。
3. 重启 AstrBot。

## 📖 使用方法

插件的核心是自然语言交互，无需记忆复杂指令。

### 场景一：直接分析合并转发

1. 在插件配置中，开启“自动分析直接发送的转发消息”。
2. 当任何人在群里或私聊中发送一条合并转发消息时，机器人会自动对其内容进行总结和分析，并发送结果。

### 场景二：回复并分析合并转发

1. 在插件配置中，开启“自动分析被引用的转发消息”。
2. 在聊天中找到一条你感兴趣的合并转发消息。
3. **回复** 这条消息，并提出你的问题，例如：
   - `这个聊了些啥？`
   - `请帮我总结一下重点。`
   - `谁提到了“预算”？`
   - 或者干脆不说话，直接回复该消息，插件会默认要求进行总结。
4. 机器人会理解你的问题，结合它看到的聊天记录，给出智能回答。

### 场景三：唤醒分析

1. 无论配置项是否开启，该场景都可用。
2. ​触发方式（回复转发 + 唤醒）​：
   * **回复** 一条包含合并转发的消息，**同时唤醒** 机器人，并提出问题（或留空让机器人默认总结）。
3. 机器人被唤醒后，会忽略配置状态，强制提取转发内容，并根据你的提问请求 LLM 分析。

## ⚙️ 配置项

你可以在 AstrBot 的插件配置页面中找到本插件的配置。**注意：修改配置后，通常需要重载插件或重启 AstrBot 才能生效。**

- **自动分析直接发送的转发消息**
  
  - **类型**: 开关 (bool)
  - **作用**: 开启后，任何用户直接发送的合并转发消息都会被自动分析。
  - **注意**: 在活跃的群聊中，这可能会消耗大量的 LLM 调用资源，请谨慎开启。
  - **默认值**: `关闭 (false)`
- **自动分析被引用的转发消息**
  
  - **类型**: 开关 (bool)
  - **作用**: 开启后，当用户回复一条合并转发消息并提问时，机器人会自动进行分析。这是推荐的使用方式。
  - **默认值**: `关闭 (false)`

## ⚠️ 注意

- 本插件主要为 QQ 平台的 `aiocqhttp` 适配器开发和测试，依赖其提供的 `get_msg` 和 `get_forward_msg` API。
- 分析结果的质量完全取决于你为 AstrBot 配置的全局 LLM 模型的能力。一个强大的多模态模型会带来更好的体验。

## 👨‍💻 作者

- EraAsh

## 🌟 支持

如果觉得这个插件对你有帮助，不妨点个 Star 鼓励一下作者吧！

[![GitHub stars](https://img.shields.io/github/stars/EraAsh/astrbot_plugin_forward_reader.svg?style=social&label=Star)](https://github.com/EraAsh/astrbot_plugin_forward_reader)

